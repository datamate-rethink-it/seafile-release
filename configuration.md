# Configuration

Seafile requires multiple configuration files. These configuration files are created by the the container's entrypoint script and overwritten on each restart.
This means that any manual changes to the configuration files **will not be persisted** across container restarts.
Instead, you can configure everything through environment variables. The advantage is that there's no need to manually edit certain configuration files.

## Outline
- [.conf Files](#conf-files)
- [gunicorn.conf.py](#gunicornconfpy)
- [seahub_settings.py](#seahub_settingspy)
- [seafile.nginx.conf](#seafilenginxconf)

## .conf Files

Any settings that you would normally configure in `.conf` files (`ccnet.conf`, `seafdav.conf`, `seafevents.conf`, `seafile.conf`) can instead be made
through environment variables by following a certain naming convention:

`PREFIX__SECTION__KEY` (where `PREFIX` is either `CCNET`, `SEAFDAV`, `SEAFEVENTS` or `SEAFILE`)

You can refer to the following documents for a list of all possible configuration settings:
- [ccnet.conf](https://manual.seafile.com/config/ccnet-conf/)
- [seafdav.conf](https://manual.seafile.com/extension/webdav/)
- [seafevents.conf](https://manual.seafile.com/config/seafevents-conf/)
- [seafile.conf](https://manual.seafile.com/config/seafile-conf/)

### Notes
- The names of the environment variables are case-sensitive
- Spaces in section names must be encoded using `0x20` (the hex representation of a space character)
- The configuration values are always strings (since the files are .ini files)

### Examples

- Changing the MySQL connection pool size for ccnet:
    - Set the `CCNET__Database__MAX_CONNECTIONS` environment variable to `200`
    - This generates the following section inside `ccnet.conf`:
      ```ini
      [Database]
      MAX_CONNECTIONS = 200
      ```
- Disabling file history for seafevents:
    - Set the `SEAFEVENTS__FILE0x20HISTORY__enabled` environment variable to `false`
    - This generates the following section inside `seafevents.conf`:
      ```ini
      [FILE HISTORY]
      enabled = false
      ```

## gunicorn.conf.py
It is currently not possible to customize this file. The file is overwritten on each restart.

## seahub_settings.py
You can customize the way `seahub_settings.py` is being generated by setting environment variables that start with `SEAHUB__`.

Similar to `.conf` files, the script that generates the configuration files looks for environment variables that follow this pattern: `SEAHUB__SETTING_NAME`

You can refer to the [docs](https://manual.seafile.com/config/seahub_settings_py/) for a list of possible configuration settings.

### Examples

- Enabling registration
    - Set the `SEAHUB__ENABLE_SIGNUP` environment variable to `true`
    - This generates the following setting inside `seahub_settings.py`:
      ```python
      ENABLE_SIGNUP = True
      ```
- Set the minimum password length
    - Set the `SEAHUB__USER_PASSWORD_MIN_LENGTH` to `16`
    - This generates the following setting inside `seahub_settings.py`:
      ```python
      USER_PASSWORD_MIN_LENGTH = 16
      ```

The python type is automatically deduced by the variable's value. There's no need to add extra quotes around values.

#### Special Cases

A few settings are handled separately since they do not use simple key-value pairs:

##### `CACHE`
You can use the following environment variables to customize the caching backend used by `seahub`:
- `SEAHUB__CACHE_BACKEND` (`memcached` or `redis`; default is `memcached`)
- `SEAHUB__CACHE_HOST`
- `SEAHUB__CACHE_PORT`

There's no necessity to modify these values if you use the provided [`seafile-pe.yml`](./compose/seafile-pe.yml) file.

##### `DATABASE`
You can use the following environment variables to customize the database accessed by `seahub`:
- `DB_HOST` (default is `mariadb`)
- `DB_ROOT_PASSWD`

##### SAML Attribute Mapping

Seafile requires you to specify the attribute mapping when using SAML.
You can use environment variables prefixed with `SEAHUB__SAML_ATTRIBUTE_MAPPING__` in order to do this.

Example:

```
SEAHUB__SAML_ATTRIBUTE_MAPPING__name=display_name
SEAHUB__SAML_ATTRIBUTE_MAPPING__mail=contact_email
```

This would generate the following configuration block inside `seahub_settings.py`:

```python
SAML_ATTRIBUTE_MAPPING = {
    'name': ('display_name', ),
    'mail': ('contact_email', ),
}
```

## seafile.nginx.conf
It is currently not possible to customize this file. The file is overwritten on each restart.

NGINX listens on port 80. There should always be a reverse proxy in front of it that also handles TLS termination (e.g. Caddy).
